services:
  agent-env:
    build:
      context: .
      args:
        REBUILD_PI_NATIVES: ${REBUILD_PI_NATIVES:-false}
        HOST_UID: ${HOST_UID:-1000}
        HOST_GID: ${HOST_GID:-1000}
        OMP_VERSION: ${OMP_VERSION:-latest}
    container_name: agent-env
    restart: unless-stopped
    network_mode: host
    volumes:
      - agent-env-home:/home/dev
      - ${HOME}/.ssh/authorized_keys:/home/dev/.ssh/authorized_keys:ro
      - ${HOME}/.ssh/known_hosts:/home/dev/.ssh/known_hosts:ro
      # ~/work, ~/projects, ~/.gitconfig*, and docker socket are mounted
      # conditionally via docker-compose.override.yml (auto-generated by dev.sh)
    environment:
      - AGENT_ENV=1
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - PPROTECT_PASSPHRASE=${PPROTECT_PASSPHRASE}
      - HOST_HOME=${HOME}
    env_file:
      - .env

volumes:
  agent-env-home:
